<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Train App</title>

	<!-- Bootstrap File -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
	 crossorigin="anonymous">

	<!-- JQuery -->
	<!-- <script src="https://code.jquery.com/jquery.js"></script> -->
	<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>

	<!-- moment.js -->
	<script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>



	<link rel="stylesheet" href="assets/style.css" />

	<!-- this will prevent chrome fromm throwing an error becasue it looks for favicon -->
	<link rel="shortcut icon" href="">





</head>

<body id="grad">

	<!-- Overall Bootstrap Grid -->
	<div class="container" id="background">



		<!-- Jumbotron with Title -->
		<div class="jumbotron">
			<h1 class="text-center">
				<strong>Catch that Train!</strong>
			</h1>

		</div>

		<div class="row">
			<div class="col-md-4" id="localtime">
				<h5>Local Time</h5>
				<p id="time"></p>
				<p id="date"></p>

			</div>

		</div>


		<!-- this is my train table div -->
		<div class="card" id="schedule">
			<div class="card-header">
				Current Train Schedule
			</div>


			<table class="table table-striped" id="train-table">
				<thead>
					<tr>
						<th>Train Name</th>
						<th>Destination</th>
						<th>First Train Time</th>
						<th>Frequency (min)</th>
						<th>Next Arrival</th>
						<th>Minutes Away</th>
					</tr>
				</thead>
				<tbody>
					<!-- this is where my rows will generate -->
				</tbody>
			</table>

		</div>







		<!-- this is my form div -->
		<div class="card mt-3" id="formdiv">
			<div class="card-header">
				Add a Train
			</div>
			<form class="ml-3 mt-3 mr-3">
				<div class="form-group">
					<label for="exampleInputEmail1">Train Name</label>
					<input class="form-control" id="name-input" aria-describedby="emailHelp" placeholder="Enter train name">

				</div>
				<div class="form-group">
					<label for="exampleInputPassword1">Destination</label>
					<input class="form-control" id="destination-input" placeholder="Destination">
				</div>
				<div class="form-group">
					<label for="exampleInputPassword1">First Train Time (HH:mm - military time)</label>
					<input class="form-control" id="start-input" placeholder="HH:mm">
				</div>
				<div class="form-group">
					<label for="exampleInputPassword1">Frequency (min)</label>
					<input class="form-control" id="frequency-input" placeholder="Frequency">
				</div>

				<button type="submit" class="btn btn-primary" id="add-train">Submit</button>
			</form>





		</div>


	</div>









	<script src="https://www.gstatic.com/firebasejs/4.11.0/firebase.js"></script>
	<script>
		$('document').ready(function () {

			// Initialize Firebase
			var config = {
				apiKey: "AIzaSyCqAZ67dimCUJVoDa5rPdHm5HkinOgZC3U",
				authDomain: "fir-hw-af841.firebaseapp.com",
				databaseURL: "https://fir-hw-af841.firebaseio.com",
				projectId: "fir-hw-af841",
				storageBucket: "fir-hw-af841.appspot.com",
				messagingSenderId: "330770599979"
			};
			firebase.initializeApp(config);



			//store the data form the database in a variable
			var database = firebase.database();

			// Initial Values
			var name = "";
			var destination = "";
			var start = 0;
			var frequency = 0;



			// Capture Button Click
			$("#add-train").on("click", function (event) {

				//prevents page from refreshing
				event.preventDefault();


				// the logic for storing and retrieving the train info
				// Don't forget to provide initial data to your Firebase database. (see lines 140-143)
				name = $("#name-input").val().trim();
				destination = $("#destination-input").val().trim();
				start = $("#start-input").val().trim();
				frequency = $("#frequency-input").val().trim();


				//organize the way our info will be pushed to the sever
				database.ref().push({

					name: name,
					destination: destination,
					start: start,
					frequency: frequency,
					dateAdded: firebase.database.ServerValue.TIMESTAMP
				});

				//clears the input box for the next suggestion
				$("#name-input").val(" ");
				$("#destination-input").val(" ");
				$("#start-input").val(" ");
				$("#frequency-input").val(" ");

			});

			//code and explanation taken from recent-user-with-all-users-solved.html
			// Firebase watcher + initial loader HINT: This code behaves similarly to .on("value")
			database.ref().on("child_added", function (childSnapshot) {

				// Log everything that's coming out of snapshot
				console.log(childSnapshot.val().name);
				console.log(childSnapshot.val().destination);
				console.log(childSnapshot.val().start);
				console.log(childSnapshot.val().frequency);



				var current_time = moment();

				// console.log(start.format());

				//save all the values to a variable

				name = (childSnapshot.val().name);
				destination = (childSnapshot.val().destination);
				start = (childSnapshot.val().start);
				frequency = (childSnapshot.val().frequency);
				var next = 0;
				var minAway = 0;
				var timeNow = 0;


				//this splits the user input into an array with [HH, mm]
				var timeArr = start.split(":");

				console.log(timeArr);


				//this gives the moment the values from time array as the user input time
				var trainTime = moment().hours(timeArr[0]).minutes(timeArr[1])

				console.log(trainTime.format("HH:mm"));

				trainTime.format("HH:mm");

				var minAway = current_time.diff(trainTime, "minutes");

				console.log(minAway);

				// console.log(current_time.diff(trainTime, "minutes"));




				// convert the train start time to unix time




				// var trainTime = (start).format("HH:mm");

				// console.log(trainTime);

				//trying something from a stackoverflow solution
				// var current_time_unix = moment();
				// var firstTrain = moment.unix(start).format("03/12/18 HH:mm");
				// console.log(firstTrain);




				//test in console
				// console.log("current time is: " + current_time);

				//now i will try to calculate the difference between current_time and trainTime
				// start.diff(current_time, "minutes");



				// var c = current_time.diff(start, 'minutes')

				// console.log(c);



				//the typeof of a variable is undefined so this might be ok, but we need to make sure it is parsing it as a number
				// console.log(typeof start);

				// var trainMinutes = moment().diff(moment.unix(current_time, start), "minutes");

				// console.log(trainMinutes);

				timeNow = moment().hours();
				console.log(timeNow);


				// Add each train's data into the table
				$("#train-table > tbody").prepend("<tr><td>" + name + "</td><td>" + destination + "</td><td>" + start + "</td><td>" + frequency + "</td><td>" + trainTime.format("HH:mm") + "</td><td>" + minAway + "</td></tr>");




				// Handle the errors
			}, function (errorObject) {
				console.log("Errors handled: " + errorObject.code);
			});


			//adiing a clock widget to show current time
			//from here since i can't seem to get my jquery to work
			//https://codepen.io/ValyTGV/pen/NAXwyQ


			window.setInterval(ut, 1000);

			function ut() {
				var d = new Date();
				// $("#time").innerHTML = d.toLocaleTimeString();
				document.getElementById("time").innerHTML = d.toLocaleTimeString();
				// $("#date").text = d.toLocaleDateString();
				document.getElementById("date").innerHTML = d.toLocaleDateString();
			}








		});
	</script>






</body>

</html>